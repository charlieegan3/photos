{{ define "title" }}
	{{ .Params.title }} - {{ $.Site.Title }}
{{ end }}

{{ define "main" }}
<div class="center cf">
	<div class="w-100 fl w-50-l center ph3-ns">
		{{ if .Params.is_video }}
			<video class="w-100 mw6 mw9-ns" autoplay loop>
				<source src="https://storage.googleapis.com/charlieegan3-instagram-archive/current/{{ .Params.file_reference }}.mp4" type="video/mp4">
				Video not supported
			</video>
		{{ else }}
			<img class="w-100 mw6 mw9-ns" src="https://storage.googleapis.com/charlieegan3-instagram-archive/current/{{ .Params.file_reference }}.jpg">
		{{ end }}
	</div>

	<div class="w-100 fl w-50-l center f7 f5-ns ph3 pt2 pt0-l">
		{{ if (gt (len .Content) 0) }}
			<div class="content">
				{{ .Content }}
			</div>
		{{ end }}

		{{ if (gt (len .Params.Tags) 0) }}
			<div class="f6-ns monospace">
				<p>
					{{ range .Params.Tags }}
						<a class="link dim mid-gray" href="{{ "/tags/" | relLangURL }}{{ . | urlize }}">#{{ . }}</a>
					{{ end }}
				</p>
			</div>
		{{ end }}

		<div>
			{{ $pageId := .Params.id }}
			{{ range .Params.locations }}
				{{ $location := ($.Site.GetPage "taxonomyTerm" "locations" .) }}

				<div id="photomap" style="width: 100%; height: 250px;"></div>
				<script>
					var lat = {{ $location.Params.lat }};
					var lon = {{ $location.Params.long }};
					var mymap = L.map('photomap', { zoomControl: false }).setView([lat, lon], 7);
					var marker = L.marker([lat, lon]).addTo(mymap);

					var OpenStreetMap_HOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(mymap);
				</script>

				<p>
					{{ if (gt (len $location.Pages) 2) }}
						<a class="link dim silver" href="{{ $location.Permalink }}">
							<span class="mid-gray">View {{ sub (len $location.Pages) 1 }} other posts near</span>
							{{ $location.Params.name }}
						</a>
						{{ $.Scratch.Set "images" (first 3 (where $location.Pages ".Params.id" "!=" $pageId)) }}
						{{ partial "photo_grid.html" $ }}
					{{ else }}
						<a class="link dim silver" href="{{ $location.Permalink }}">
							<span class="mid-gray">View posts near</span>
							{{ $location.Params.name }}
						</a>
					{{ end }}
				</p>
			{{ end }}
		</div>

		<p>
			<a class="link dim silver" href="https://www.instagram.com/p/{{ .Params.code }}">
				<span class="mid-gray">View this post on</span>
				Instagram
			</a>
		</p>
	</div>
</div>
{{ end }}
