{{ define "title" }}
	{{- .Title -}} - {{- $.Site.Title -}}
{{ end }}

{{ define "main" }}
<div class="mw7 center cf">
	{{- $.Scratch.Set "posts" (where $.Site.Pages "Type" "photos") -}}
	{{- partial "post_map.html" $ -}}
	<br>

	{{- range $_, $location := .Data.Terms.ByCount -}}
		{{- $page := ($.Site.GetPage "taxonomyTerm" "locations" $location.Name) -}}
		{{- if (ne $page.Params.name "") -}}
			<div class="fl w-third">
				<a href="{{ $page.Permalink }}" class="db aspect-ratio aspect-ratio--1x1 dim">
					<div style="margin: auto; width: 100%; z-index: 1000; position: absolute; top: 50%; margin-top: -50px;">
						<p class="tc f7 f5-ns near-white" style="overflow: hidden; text-overflow: ellipsis;">{{ replaceRE ",.*" "" $page.Params.name }}</p>
						<p class="tc f7 f6-ns silver">{{ len $location.WeightedPages }} posts</p>
					</div>
					<span role="img" data-src="{{ $.Site.Params.image_source }}{{ (index ($location.WeightedPages) 0).Params.file_reference }}.jpg&w={{ $.Site.Params.grid_image_size }}" class="bg-center cover aspect-ratio--object lazyload o-40"></span>
					{{- partial "post.html" (dict "image_source" $.Site.Params.image_source "video_source" $.Site.Params.video_source "grid_image_size" $.Site.Params.grid_image_size "post" (index ($location.WeightedPages) 0) "opacity" "o-40") -}}
				</a>
			</div>
		{{- end -}}
	{{- end -}}
</div>
{{- end -}}
